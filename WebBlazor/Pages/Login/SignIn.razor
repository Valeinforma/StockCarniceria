@page "/signin"
@inject SweetAlertService sweetAlert
@inject FirebaseAuthService firebaseAuthService
@inject NavigationManager navigation

<PageTitle>Registro de Usuario</PageTitle>

<div class="d-flex justify-content-center align-items-center" style="min-height: 80vh;">
    <div class="card text-center shadow-lg" style="max-width: 600px; width: 100%;">
        <div class="card-header bg-success text-white">
            Registro de Usuario
        </div>
        <div class="card-body">
            <h4 class="card-title mb-4">Crea una cuenta en StockCarniceria</h4>
            
            <!-- Usamos un EditForm o un formulario estándar. Aquí se mantiene el <form> original. -->
            <form class="form-horizontal text-start">
                
                <div class="form-group row mb-3 align-items-center">
                    <label class="col-sm-3 col-form-label fw-bold" for="Nombre">Nombre:</label>
                    <div class="col-sm-9">
                        <InputText id="Nombre" class="form-control" @bind-Value="name" placeholder="Tu nombre completo" />
                    </div>
                </div>

                <div class="form-group row mb-3 align-items-center">
                    <label class="col-sm-3 col-form-label fw-bold" for="email">Email:</label>
                    <div class="col-sm-9">
                        <InputText type="email" id="email" class="form-control" @bind-Value="email" placeholder="correo@ejemplo.com" />
                    </div>
                </div>

                <div class="form-group row mb-3 align-items-center">
                    <label class="col-sm-3 col-form-label fw-bold" for="password">Contraseña:</label>
                    <div class="col-sm-9">
                        <InputText type="password" id="password" class="form-control" @bind-Value="password" placeholder="Mínimo 6 caracteres" />
                    </div>
                </div>

                <div class="form-group row mb-4 align-items-center">
                    <label class="col-sm-3 col-form-label fw-bold" for="passwordverify">Confirmar Contraseña:</label>
                    <div class="col-sm-9">
                        <InputText type="password" id="passwordverify" class="form-control" @bind-Value="passwordverify" placeholder="Repite la contraseña" />
                    </div>
                </div>

                <div class="form-group row">
                    <div class="col-sm-9 offset-sm-3">
                        <button type="button" class="btn btn-primary w-100" @onclick="Register">
                            <span class="bi bi-person-plus me-2"></span> Registrar
                        </button>
                    </div>
                </div>
                
                <div class="form-group row mt-3">
                    <div class="col-sm-9 offset-sm-3">
                        <button type="button" class="btn btn-primary mb-2" @onclick="Register">Enviar</button>

                        
                    </div>
                </div>
            </form>
        </div>
        <div class="card-footer text-muted">
            StockCarniceria
        </div>
    </div>
</div>


@code {
    string name = string.Empty;
    string email = string.Empty;
    string password = string.Empty;
    string passwordverify = string.Empty;

    private async Task Register()
    {
        // 1. Validación de campos vacíos
        if (string.IsNullOrWhiteSpace(name) || string.IsNullOrWhiteSpace(email) || string.IsNullOrWhiteSpace(password) || string.IsNullOrWhiteSpace(passwordverify))
        {
            await sweetAlert.FireAsync("Error", "Por favor, complete todos los campos.", SweetAlertIcon.Error);
            return;
        }
        
        // 2. Validación de coincidencia de contraseñas
        if (password != passwordverify)
        {
            await sweetAlert.FireAsync("Error", "Las contraseñas no coinciden.", SweetAlertIcon.Error);
            return;
        }

        // 3. Llamada al servicio de Firebase
        var result = await firebaseAuthService.createUserWithEmailAndPassword(email, password, name);
        
        if (result is not null) // Si el usuario se creó correctamente (result no es null)
        {
            await sweetAlert.FireAsync("Éxito", "Usuario registrado correctamente. Revisa tu correo electrónico para verificar tu cuenta.", SweetAlertIcon.Success);
            
            // Limpiar los campos y redirigir
            name = string.Empty;
            email = string.Empty;
            password = string.Empty;
            passwordverify = string.Empty;
            navigation.NavigateTo("/login");
        }
        else
        {
         
            await sweetAlert.FireAsync("Error", "Error al registrar el usuario. El email podría estar en uso o la contraseña es muy débil.", SweetAlertIcon.Error);
        }
    }
}