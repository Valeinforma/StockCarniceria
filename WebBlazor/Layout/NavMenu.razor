@inject FirebaseAuthService _firebaseAuthService

<div class="sidebar">
    <!-- Encabezado del Sidebar -->
    <div class="sidebar-header">
        <span class="meat-emoji">🥩</span>
        <h2>StockCarnicería</h2>
    </div>

    <!-- Navegación principal -->
    <nav class="sidebar-nav">
        <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
            <span class="nav-icon">🏠</span>
            <span>Inicio</span>
        </NavLink>

        @if (isAuthenticated)
        {
            <NavLink class="nav-link" href="productos">
                <span class="nav-icon">📦</span>
                <span>Stock</span>
            </NavLink>

            <NavLink class="nav-link" href="categorias">
                <span class="nav-icon">🏷️</span>
                <span>Categorías</span>
            </NavLink>

            <NavLink class="nav-link" href="ventas">
                <span class="nav-icon">💰</span>
                <span>Ventas</span>
            </NavLink>

            <NavLink class="nav-link" href="proveedores">
                <span class="nav-icon">🚚</span>
                <span>Proveedores</span>
            </NavLink>
        }
    </nav>

    <!-- Autenticación -->
    <div class="sidebar-bottom">
        <NavLink class="nav-link" href="login">
            <span class="nav-icon">@(isAuthenticated ? "🚪" : "🔑")</span>
            <span>@textBtnLogin</span>
        </NavLink>
        <div class="sidebar-footer">
            <p>ISP20</p>
            <p>2025</p>
        </div>
    </div>
</div>

@code {
    private bool isAuthenticated = false;
    private string textBtnLogin => isAuthenticated ? "Cerrar sesión" : "Iniciar sesión";

    protected override async Task OnInitializedAsync()
    {
        isAuthenticated = await _firebaseAuthService.IsUserAuthenticated();
        _firebaseAuthService.OnChangeLogin += LoginHasChanged;
    }

    public void Dispose()
    {
        _firebaseAuthService.OnChangeLogin -= LoginHasChanged;
    }

    private async void LoginHasChanged()
    {
        isAuthenticated = await _firebaseAuthService.IsUserAuthenticated();
        await InvokeAsync(StateHasChanged);
    }
}